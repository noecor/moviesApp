<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <link href="styles/styles2.css" rel="stylesheet" type="text/css">
    <link href='http://fonts.googleapis.com/css?family=Lato&subset=latin,latin-ext' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.1/css/all.css"
        integrity="sha384-50oBUHEmvpQ+1lW4y57PTFmhCaXp0ML5d60M1M7uH2+nqUivzIebhndOJK28anvf" crossorigin="anonymous">
</head>
<body>
    <nav>
        <a href="#" class="logo"><img src="images/assets/logo.svg"></a>
        <ul class="navigation-list">
            <li class="navigation-item"><a href="#"><i class="far fa-star"></i><span>POPULAR</span></a></li>
            <li class="navigation-item"><a href="#"><i class="fas fa-arrow-up"></i><span>TOP RATED</span></a></li>
            <li class="navigation-item"><a href="#"><i class="far fa-calendar-alt"></i><span>UPCOMING</span></a></li>
            <li class="navigation-item"><a href="#"><i class="far fa-play-circle"></i><span>NOW PLAYING</span></a></li>
        </ul>
    </nav>
    <div class="placeholder">
            <i class="fas fa-search search"></i>
            <input type="text" id="searchBox" placeholder="Search for a movie..." onkeyup="search()">
            <ul id="results" class="results"></ul>
        </div>
    <div class="container">
        <div class="header">
            <h1>THE MOVIE DB APP</h1>
            <div class="banner">
            </div>
        </div>
        <div class="content">
            <div class="movies-category">
                <h2>Popular Movies</h2> 
                <a href="#">View All <i class="fas fa-arrow-right"></i></a> 
            </div>
            <div class="movies">
                    <ul id="popular-movies">

                    </ul>
            </div>

        </div>
    </div>

    <script>
        let lastRequest;
        let api_key = '3631da5fba4115a4ce320e971a2fdadb';
        let content = document.getElementById('popular-movies')


        const search = () => {
	    let query = event.target.value;
	        if (query.length >= 3 || (event.keyCode === 13 && query !== lastRequest)) {
		lastRequest = query;
		fetch(`https://api.themoviedb.org/3/search/movie?api_key=${api_key}&query=${query}`)
			.then((res) => res.json())
			.then((res) => printQueryResults(res.results));
	        }
        };

        const printQueryResults = (movies) => {
	    const container = document.getElementById('results');
	    container.innerHTML = '';

	    movies.forEach((mov) => {
		let movie = document.createElement('a');
		let title = mov.title === mov.original_title ? mov.title : `${mov.title} (${mov.original_title})`;
		movie.innerText = title;
		movie.href = '#';
		movie.onclick = () => openModal(mov);
		container.appendChild(movie);
	        });
        };

        const popularMovies = `https://api.themoviedb.org/3/movie/popular?api_key=${api_key}`;
        fetch(popularMovies)
        .then(response => response.json())
        .then(response => {
            response.results.forEach(e =>{
                popularResults(e);
            });

        });

        const popularResults = e => {
            const popMovies = document.getElementById('popular-movies');
            const urlMovie = `https://api.themoviedb.org/3/movie/${e.id}?api_key=${api_key}`;
            const image = `https://image.tmdb.org/t/p/w300/${e.poster_path}`;
            const popResults =
            `<li>
            <a href="${urlMovie}"><figure><img class="thumb" src="${image}"</img><p>${e.title}</p></figure>
            </a>
            </li>`;
            content.insertAdjacentHTML('beforeEnd', popResults)            
        }
    
    </script>
</body>
</html>
